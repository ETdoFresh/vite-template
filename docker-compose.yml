version: '3.8'

services:
  vite-app:
    image: node:20-alpine
    working_dir: /app
    volumes:
      - app-data:/app
      - .:/vite-template:ro
      - /app/node_modules
    command: sh -c "
      if [ ! -f /app/package.json ]; then
        echo 'First run detected, copying template files to volume...';

        echo 'ðŸ“‚ Files in /vite-template'
        ls /vite-template

        echo 'ðŸ“‚ Files in /app'
        ls /app

        cp -r /vite-template/* /app/ 2>/dev/null || true;
        cp -r /vite-template/.[^.]* /app/ 2>/dev/null || true;
      fi;
      npm install && npm run dev -- --host 0.0.0.0"
    environment:
      - NODE_ENV=development
    restart: unless-stopped

volumes:
  app-data: